# Copilot Instructions ガイドライン

このファイルは、GitHub Copilotが提出されたPRをレビューするときのガイドラインを提供します。以下のルールに従ってください。

## プロジェクト概要

`../CLAUDE.md` に記載してあるので確認してください。

## 使用言語

- 指摘事項は日本語で記載してください。

## レビューガイドライン

### 全般的な校閲

- 提供されたファイルの中に日本語の誤字がないか確認してください
- 文法的な誤りや不自然な表現がないか確認してください
- 英単語についてはスペルミスが無いかの確認をしてください
- ドキュメントには固有名詞が多く含まれるため、固有名詞のスペルミスは指摘しないでください

### セキュリティ

- **最小権限の原則**: `permissions` は必要最小限のスコープだけを指定しているか確認してください。ワークフロー全体ではなくジョブ単位で設定することを推奨します
- **スクリプトインジェクション対策**: `${{ }}` 式でユーザー制御可能な値（`github.event.pull_request.title`、`github.event.issue.body` など）をシェルスクリプト内で直接展開していないか確認してください。環境変数経由で渡すか、`actions/github-script` 内で安全に処理してください
- **トークンの取り扱い**: `secrets.GITHUB_TOKEN` や入力で受け取ったトークンがログに出力されていないか確認してください
- **サードパーティActionのピン留め**: 外部のActionを使用する際は、タグ（`@v8` など）ではなくコミットSHAでピン留めすることを推奨します。自組織のActionやGitHub公式Action（`actions/*`）はタグ指定でも許容します

### ワークフロー設計

- **トリガーの適切性**: `on` イベントの `types` を必要なものだけに絞っているか確認してください。不要なトリガーはワークフローの無駄な実行につながります
- **条件分岐**: ジョブやステップの `if` 条件が適切か確認してください。不要な実行を避けるために、早期リターンのパターンを推奨します
- **ジョブの分割**: 独立した処理は別ジョブに分割し、`needs` で依存関係を明示してください。ただし、過度な分割による複雑化は避けてください
- **タイムアウト**: 長時間実行される可能性のあるジョブには `timeout-minutes` を設定してください

### Composite Action設計

- **入力の定義**: `inputs` には `description` と `required` を必ず記載してください。デフォルト値がある場合は `default` も明記してください
- **出力の定義**: 呼び出し元が結果を利用する必要がある場合は `outputs` を定義してください
- **エラーハンドリング**: シェルステップでは `shell: bash` を明示し、エラー時に適切に失敗するようにしてください。`set -e` の使用や、`core.setFailed()` による明示的なエラー通知を推奨します
- **冪等性**: 同じ入力で複数回実行しても安全であるか確認してください

### シェルスクリプト

- **変数のクォート**: シェル変数は `"$VAR"` のようにダブルクォートで囲んでください。クォートなしの変数展開はワード分割やグロブ展開の原因になります
- **`GITHUB_OUTPUT` の使用**: `::set-output` は非推奨です。`echo "key=value" >> $GITHUB_OUTPUT` を使用してください
- **`GITHUB_ENV` の使用**: `::set-env` は非推奨です。`echo "key=value" >> $GITHUB_ENV` を使用してください
- **パイプの安全性**: パイプラインの途中で失敗を検知する必要がある場合は `set -o pipefail` を使用してください

### `actions/github-script` の利用

- **API呼び出しのエラーハンドリング**: GitHub API呼び出しには適切なtry-catchを設け、失敗時に分かりやすいメッセージを出力してください
- **ページネーション**: リスト系APIを使用する場合はページネーションを考慮してください。`github.paginate()` の使用を推奨します
- **レート制限**: ループ内での大量のAPI呼び出しはレート制限に注意してください